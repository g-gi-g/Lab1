@model IEnumerable<MarketplaceWebApplication.Data.Feedback>
@using Microsoft.AspNetCore.Http
@using MarketplaceWebApplication.Extensions
@using MarketplaceWebApplication.Models
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Відгуки";
    var userInfo = HttpContextAccessor.HttpContext.Session.GetObjectFromJson<UserDetails>("UserDetails");
}

<h3 style="text-align:center">Відгуки</h3>

<h5>Статистика відгуків</h5>

<div class="row">
    <div class="col-3">
        <div id="countByRatingChart"></div>
    </div>
</div>
@section Scripts
{
    <script type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
         google.charts.load('current', {'packages':['corechart']});
         google.charts.setOnLoadCallback(drawCharts);
         function drawCharts() {
            fetch(`/api/charts/countByRating`)
             .then(response => response.json())
             .then(data => {
             const dataTable = new
             google.visualization.DataTable();
             dataTable.addColumn('string', 'Оцінка');
             dataTable.addColumn('number', 'Кількість відгуків');

             data.forEach(item => {
             dataTable.addRow([item.Rating, item.Count]);
             });

             const options = {
             title: 'Відгуки за рейтингом',
             width: 1400,
             height: 400,
             legend: { position: 'none' },
             };

             const chart = new
             google.visualization.ColumnChart(document.getElementById('countByRatingChart'));
             chart.draw(dataTable, options);
             });
         }
    </script>
}

@foreach (var item in Model)
{
    <div class="card">
        <h5 class="card-header">@item.User.Username</h5>
        <div class="card-body">
            <h5 class="card-title">@item.Rating / 5</h5>
            <p class="card-text">@item.Text</p>
            <p class="card-text">@item.TimeAdded</p>
            @if (userInfo is not null && userInfo.Id == item.UserId)
            {
                <a href="@Url.Action("Delete", "Feedbacks", new { id = item.Id })" class="btn btn-danger">Видалити</a>
            }
        </div>
    </div>
    <hr />
}

<var>
    <a asp-controller="Offers" asp-action="MainPageView" class="btn btn-primary">Назад</a>
</var>
